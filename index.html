<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Campus Navigator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

  <style>
    :root{
      --accent: #2563eb;
      --muted: #6b7280;
      --card: rgba(255,255,255,0.95);
    }
    html,body{height:100%;margin:0;font-family:Inter, system-ui, Arial, sans-serif;background:#f3f6fb}
    #map{height:100vh;width:100%}

    #sidebar{
      position:absolute; top:18px; left:18px; z-index:1100;
      width:320px;
      background:var(--card);
      border-radius:12px;
      box-shadow:0 8px 30px rgba(20,20,40,0.12);
      padding:14px;
      overflow:hidden;
    }
    #sidebar h1{font-size:18px;margin:0 0 8px 0;color:#0f172a}
    .controls{display:flex;gap:8px;margin-bottom:10px}
    .search{
      flex:1;
      padding:8px 10px;border-radius:10px;border:1px solid #e6e9ef;font-size:14px;
    }
    .btn{
      background:var(--accent); color:white; border:none; padding:8px 10px; border-radius:10px; cursor:pointer; font-size:14px;
    }
    .small-btn{background:white;color:var(--accent);border:1px solid #e6e9ef;padding:7px 8px;border-radius:8px;cursor:pointer}
    .filters{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px}
    .chip{padding:6px 8px;border-radius:999px;background:#fff;border:1px solid #eef2ff;color:var(--muted);font-size:13px;cursor:pointer}
    .chip.active{background:linear-gradient(90deg,#eef2ff,#e6f0ff);color:var(--accent);border-color:rgba(37,99,235,0.15)}
    .places-list{max-height:52vh;overflow:auto;padding-right:6px}
    .place-item{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;background:linear-gradient(180deg,#ffffff,#fbfdff);margin-bottom:8px;border:1px solid #eef2f7}
    .place-meta{font-size:13px;color:var(--muted)}
    .place-title{font-weight:600;color:#0f172a}
    .footer-card{font-size:12px;color:var(--muted);margin-top:8px;text-align:center}

    .floating-controls{
      position:absolute;right:18px;top:18px;z-index:1100;display:flex;flex-direction:column;gap:8px
    }
    .float-btn{background:white;border-radius:10px;padding:10px 12px;border:1px solid #eef2f7;cursor:pointer;box-shadow:0 6px 18px rgba(12,15,30,0.06)}

    @media (max-width:880px){
      #sidebar{
        left:10px;right:10px;width:auto;top:14px;padding:12px;
      }
      .places-list{max-height:34vh}
    }

    @media (max-width:600px){
      #sidebar{
        width:100%;
        left:0; right:0;
        border-radius:0 0 12px 12px;
      }
      #sidebar h1{
        font-size:16px;
      }
      .place-item{
        flex-direction:column;
        align-items:flex-start;
      }
      .controls{
        flex-direction:column;
      }
      .filters{
        justify-content:center;
      }
      .floating-controls{
        right:10px; top:auto; bottom:20px;
      }
    }

    @media (max-width:420px){
      #sidebar{
        padding:10px;
      }
      .chip{font-size:12px;padding:5px 6px}
      .place-title{font-size:14px}
    }
    #sidebar {
  transition: 0.3s ease;
}

</style>

</head>
<body>
  <button id="toggleSidebar" class="small-btn" style="position:absolute;top:10px;left:10px;z-index:1200">‚ò∞</button>


  <div id="sidebar">
    <h1>Campus Navigator ‚Äî Bishop Heber College</h1>

    <div class="controls">
      <input id="searchInput" class="search" placeholder="Search (e.g., Library, GJ Block)" />
      <button id="centerBtn" class="small-btn" title="Center map">Center</button>
    </div>
     <div class="places-list" id="placesList">
    </div> 

    <div class="footer-card">
      Tip: Click a place ‚Üí in popup press <b>Get Directions</b> to route from your current location.
    </div>
  </div>

  <div class="floating-controls">
    <button id="locateBtn" class="float-btn" title="Locate me">üìç Locate Me</button>
    <button id="clearRouteBtn" class="float-btn" title="Clear route">üß≠ Clear Route</button>
  </div>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.min.js"></script>
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

  
  <script>
    const CAMPUS_CENTER = [10.8148, 78.6740];
    const DEFAULT_ZOOM = 18;
    const PLACES = [
      { id:1, name:"Admin Block", category:"admin", lat:10.814708, lng:78.673172},
      { id:2, name:"GJ Block", category:"department", lat:10.815482, lng:78.674400},
      { id:3, name:"Arts & Science Block", category:"department", lat:10.815032, lng:78.672766 },
      { id:4, name:"Aided Office", category:"office", lat:10.814815, lng:78.672964},
      { id:5, name:"Multipurpose Auditorium", category:"auditorium", lat:10.815179, lng:78.673989},
      { id:6, name:"Central Library", category:"library", lat:10.814827, lng:78.673892},
      { id:7, name:"Stone bench Canteen", category:"canteen", lat:10.815237, lng:78.672976},
      { id:8, name:"Tennis academy", category:"sports", lat:10.816055, lng:78.675205},
      { id:9, name:"Football Ground", category:"sports", lat:10.815711, lng:78.673351},
      { id:10, name:"Main Gate / Entrance", category:"entrance", lat:10.814018, lng:78.673290},
      { id:11, name:"Computer Science Dept.", category:"department", lat:10.815184, lng:78.673198},
      { id:12, name:"College parking", category:"transport", lat:10.815421, lng:78.674170},
      { id:13, name:"Student parking", category:"transport", lat:10.815115, lng:78.674581},
      { id:14, name:"PG Block", category:"department", lat:10.814502, lng:78.672940},
      { id:15, name:"Church", category:"department", lat:10.816106, lng:78.674041},
      { id:16, name:"Canteen", category:"canteen", lat:10.815673, lng:78.674091},
      { id:17, name:"Cafeteria ", category:"canteen", lat:10.814452, lng:78.674006},
      { id:18, name:"Back gate", category:"entrance", lat:10.815771, lng:78.677368},
      { id:19, name:"Boys gate", category:"entrance", lat:10.814476, lng:78.674900},
      { id:20, name:"IT department", category:"department", lat:10.815511, lng:78.677281},
    ];

    const CATS = {
      department:{label:"Departments", color:"#0ea5a4"},
      admin:{label:"Administration", color:"#7c3aed"},
      library:{label:"Library", color:"#2563eb"},
      canteen:{label:"Canteen", color:"#f97316"},
      auditorium:{label:"Auditorium", color:"#ef4444"},
      hostel:{label:"Hostel", color:"#0ea5a4"},
      sports:{label:"Sports", color:"#16a34a"},
      entrance:{label:"Entrance", color:"#8b5cf6"},
      office:{label:"Office", color:"#6b7280"},
      transport:{label:"Transport", color:"#0ea5a4"}
    };

    const map = L.map('map', { zoomControl:false }).setView(CAMPUS_CENTER, DEFAULT_ZOOM);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:22 }).addTo(map);

    L.control.zoom({ position: 'bottomright' }).addTo(map);

    const markerGroup = L.markerClusterGroup({
  chunkedLoading: true,
  showCoverageOnHover: false,
  zoomToBoundsOnClick: false  
});
    map.setView(CAMPUS_CENTER, DEFAULT_ZOOM, { animate: false });

    const placeIdToMarker = new Map();

    function makeMarker(place){
      const html = `<div style=
          "width:18px;height:18px;border-radius:50%;
          background:${CATS[place.category]?.color || '#2563eb'};
          border:2px solid white;box-shadow:0 1px 4px rgba(0,0,0,0.25)"></div>`;
      const icon = L.divIcon({ html:html, className:'custom-marker', iconSize:[24,24], iconAnchor:[12,12] });

      const m = L.marker([place.lat, place.lng], { icon: icon, title: place.name });
      const popupHtml = `
  <div style="min-width:200px">
    <div style="font-weight:700;margin-bottom:6px">${place.name}</div>
    <div style="font-size:13px;color:#374151;margin-bottom:8px">${place.desc || ''}</div>
    <div style="display:flex;gap:8px">
      <button onclick="startRouting(${place.lat}, ${place.lng})" style="flex:1;padding:8px;border-radius:8px;border:none;background:${getColor(place.category)};color:white;cursor:pointer">Get Directions</button>
      <button onclick="centerTo(${place.lat}, ${place.lng})" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e6eefc;background:white;color:${getColor(place.category)};cursor:pointer">Center</button>
    </div>
  </div>
`;

      m.bindPopup(popupHtml);
      return m;
    }

    function getColor(cat){ return CATS[cat]?.color || '#2563eb' }

    // add all markers
    PLACES.forEach(p => {
      const m = makeMarker(p);
      markerGroup.addLayer(m);
      placeIdToMarker.set(p.id, m);
    });
    map.addLayer(markerGroup);
    map.setView(CAMPUS_CENTER, DEFAULT_ZOOM, { animate: false });

    const placesListEl = document.getElementById('placesList');

    function renderPlacesList(){
      placesListEl.innerHTML = '';
      const q = document.getElementById('searchInput').value.trim().toLowerCase();

      const filtered = PLACES.filter(p => (p.name.toLowerCase().includes(q) || (p.desc||'').toLowerCase().includes(q)));

      if(filtered.length === 0){
        placesListEl.innerHTML = '<div style="color:#6b7280;padding:10px">No places found.</div>';
        return;
      }

      filtered.forEach(p => {
        const it = document.createElement('div');
        it.className = 'place-item';
        it.innerHTML = `
          <div style="flex:1">
            <div class="place-title">${p.name}</div>
            <div class="place-meta">${CATS[p.category]?.label || p.category} ‚Ä¢ ${p.desc || ''}</div>
            <div style="margin-top:8px;display:flex;gap:8px">
              <button class="btn" style="background:${getColor(p.category)};flex:1" onclick="openPopup(${p.id})">Open</button>
              <button style="flex:1;border-radius:8px;border:1px solid #e6eefc;background:white;color:${getColor(p.category)}" onclick="startRouting(${p.lat}, ${p.lng})">Route</button>
            </div>
          </div>
        `;
        placesListEl.appendChild(it);
      });
    }

    function centerTo(lat,lng){
      map.setView([lat,lng], 20);
      L.popup({offset:[0,-12]}).setLatLng([lat,lng]).setContent('Here:').openOn(map);
    }
    window.centerTo = centerTo;

    function openPopup(id){
      const marker = placeIdToMarker.get(id);
      if(!marker) return;
      marker.openPopup();
      map.setView(marker.getLatLng(), 20);
    }
    window.openPopup = openPopup;

    const searchInput = document.getElementById('searchInput');
    document.getElementById('centerBtn').addEventListener('click', ()=> map.setView(CAMPUS_CENTER, DEFAULT_ZOOM));
    searchInput.addEventListener('input', () => { renderPlacesList(); });

    if (L.Control.Geocoder) {
      const geocoder = L.Control.geocoder({ position:'topleft', defaultMarkGeocode:false })
        .on('markgeocode', function(e) {
          const latlng = e.geocode.center;
          map.setView(latlng, 19);
        }).addTo(map);
    }

    renderPlacesList();

    let liveMarker = null;
    function onLocationUpdate(pos){
      const lat = pos.coords.latitude, lng = pos.coords.longitude;
      if(!liveMarker){
        liveMarker = L.circleMarker([lat,lng], { radius:8, color:'#fff', weight:2, fillColor:'#2563eb', fillOpacity:1 }).addTo(map);
        liveMarker.bindPopup('You are here');
      } else {
        liveMarker.setLatLng([lat,lng]);
      }
    }

    function onLocationError(err){
      console.warn('Location error', err);
    }

    if(navigator.geolocation){
      navigator.geolocation.watchPosition(onLocationUpdate, onLocationError, { enableHighAccuracy:true, maximumAge:2000, timeout:10000 });
    }

    document.getElementById('locateBtn').addEventListener('click', () => {
      if(!navigator.geolocation) return alert('Geolocation not supported');
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude, lng = pos.coords.longitude;
        map.setView([lat,lng], 19);
        if(!liveMarker) onLocationUpdate(pos);
        liveMarker.openPopup();
      }, err => { alert('Unable to get location: ' + (err.message || err.code)); }, { enableHighAccuracy:true });
    });

    let routingControl = null;
    function startRouting(destLat, destLng){
      if(!navigator.geolocation){
        alert('Geolocation needed for routing');
        return;
      }

      if(routingControl){
        map.removeControl(routingControl);
        routingControl = null;
      }

      navigator.geolocation.getCurrentPosition(pos => {
        const from = L.latLng(pos.coords.latitude, pos.coords.longitude);
        const to = L.latLng(destLat, destLng);

        routingControl = L.Routing.control({
          waypoints: [ from, to ],
          routeWhileDragging: false,
          showAlternatives: false,
          fitSelectedRoute: true,
          lineOptions: { styles: [{ color: '#2563eb', opacity: 0.9, weight: 6 }] },
          createMarker: function(i, wp, n){
            if(i === 0){
              return L.circleMarker(wp.latLng, { radius:7, fillColor:'#34d399', color:'#fff', weight:2, fillOpacity:1 }).bindPopup('Start: You');
            } else {
              return L.marker(wp.latLng, { title:'Destination' });
            }
          },
          router: L.Routing.osrmv1({ serviceUrl: 'https://router.project-osrm.org/route/v1' })
        }).addTo(map);

      }, err => {
        alert('Unable to get your location for routing. Allow location permission and try again.');
      }, { enableHighAccuracy:true });
    }
    window.startRouting = startRouting;

    document.getElementById('clearRouteBtn').addEventListener('click', () => {
  if (routingControl) {
    routingControl.getPlan().setWaypoints([]); 
    map.removeControl(routingControl);

    if (routingControl._line) {
      map.removeLayer(routingControl._line);
    }
    if (routingControl._alternatives) {
      routingControl._alternatives.forEach(alt => map.removeLayer(alt));
    }

    routingControl = null;
  }
});

    function hexToRgba(hex, a=1){
      const h = hex.replace('#','');
      const bigint = parseInt(h,16);
      const r = (bigint >> 16) & 255;
      const g = (bigint >> 8) & 255;
      const b = bigint & 255;
      return `rgba(${r}, ${g}, ${b}, ${a})`;
    }
const sidebar = document.getElementById("sidebar");
const toggleBtn = document.getElementById("toggleSidebar");

let isCollapsed = false;

toggleBtn.addEventListener("click", () => {
  if (!isCollapsed) {
    sidebar.style.transform = "translateX(-110%)";
    sidebar.style.transition = "0.3s ease";
    toggleBtn.textContent = "‚ò∞";
  } else {
    sidebar.style.transform = "translateX(0)";
    toggleBtn.textContent = "√ó";
  }
  isCollapsed = !isCollapsed;
});


  </script>
</body>
</html>
